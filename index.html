<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ESP32 WebRTC Viewer</title>
<style>
body { background:#111; color:#fff; text-align:center; }
video { width:90%; max-width:500px; margin-top:20px; border-radius:12px; background:#000; }
</style>
</head>
<body>

<h2>ESP32-CAM WebRTC Viewer</h2>
<video id="remoteVideo" autoplay playsinline></video>

<script>
const ws = new WebSocket("wss://YOUR-SIGNALING-URL/ws");

const pc = new RTCPeerConnection({
    iceServers: [
        { urls: "stun:stun.l.google.com:19302" }
    ]
});

pc.ontrack = (event) => {
    document.getElementById("remoteVideo").srcObject = event.streams[0];
};

pc.onicecandidate = event => {
    if (event.candidate) {
        ws.send(JSON.stringify({
            type: "ice",
            to: "camera",
            candidate: event.candidate
        }));
    }
};

ws.onopen = () => {
    ws.send(JSON.stringify({ type:"register", role:"browser" }));
};

// Incoming messages
ws.onmessage = async (event) => {
    const data = JSON.parse(event.data);

    if (data.type === "offer") {
        await pc.setRemoteDescription(data);
        const answer = await pc.createAnswer();
        await pc.setLocalDescription(answer);

        ws.send(JSON.stringify({
            type: "answer",
            sdp: answer.sdp,
            to: "camera"
        }));
    }

    if (data.type === "ice" && data.candidate) {
        try { pc.addIceCandidate(data.candidate); } catch(e){}
    }
};
</script>

</body>
</html>
